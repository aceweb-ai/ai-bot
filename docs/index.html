<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç AI-–±–æ—Ç–∞</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
   <!-- –ü—Ä–∏–º–µ—Ä–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤–Ω—É—Ç—Ä–∏ —Ç–µ–≥–∞ <body> -->
<div id="chat-widget">
    <div class="chat-header">
        <h2>ü´ô –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –ù–∞—Ç—É—Ä–∞–ª–ú–∞–≥</h2>
    </div>
    <div class="chat-messages" id="message-area">
        <!-- –°–æ–æ–±—â–µ–Ω–∏—è –±—É–¥—É—Ç –≤—Å—Ç–∞–≤–ª—è—Ç—å—Å—è —Å—é–¥–∞ -->
        <div class="typing-indicator" id="typing-indicator">–ë–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...</div>
    </div>
    <div class="chat-input-area">
        <input type="text" id="user-input" placeholder="–ó–∞–¥–∞–π—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å...">
        <button id="send-button">‚û§</button>
    </div>
</div>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
   <script>
    // ===== –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø =====
    // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ 'YOUR_VERCEL_API_URL' –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π URL –≤–∞—à–µ–≥–æ –±—ç–∫–µ–Ω–¥–∞ –Ω–∞ Vercel
    const BACKEND_URL = 'https://ai-bot-peach-one.vercel.app/api/ask-bot';
    
    // ===== –°–û–°–¢–û–Ø–ù–ò–ï –ß–ê–¢–ê =====
    let conversationHistory = []; // –•—Ä–∞–Ω–∏—Ç –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞ –¥–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
    const MAX_CONTEXT_MESSAGES = 20; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏
    // ===== –ü–û–õ–£–ß–ï–ù–ò–ï –≠–õ–ï–ú–ï–ù–¢–û–í DOM =====
    const messageArea = document.getElementById('message-area');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const typingIndicator = document.getElementById('typing-indicator');
    
    // ===== –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø =====
    // –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –±–æ—Ç–∞ (–º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å)
    addMessage('–ü—Ä–∏–≤–µ—Ç! –Ø –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –º–∞–≥–∞–∑–∏–Ω–∞ "–ù–∞—Ç—É—Ä–∞–ª–ú–∞–≥". –°–ø—Ä–æ—Å–∏—Ç–µ –º–µ–Ω—è –æ –º–∞–≥–Ω–∏–∏, –¥–æ—Å—Ç–∞–≤–∫–µ –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é.', 'bot');
    
    // ===== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò =====
    
    // –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –∏—Å—Ç–æ—Ä–∏—é –∏ –Ω–∞ —ç–∫—Ä–∞–Ω
    function addMessage(text, sender) {
    // 1. –î–æ–±–∞–≤–ª—è–µ–º –≤ –º–∞—Å—Å–∏–≤ –∏—Å—Ç–æ—Ä–∏–∏
    conversationHistory.push({
        role: sender === 'user' ? 'user' : 'assistant',
        content: text
    });
    
    // 2. –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –¥–ª–∏–Ω—É –∏—Å—Ç–æ—Ä–∏–∏, —á—Ç–æ–±—ã –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ
    if (conversationHistory.length > MAX_CONTEXT_MESSAGES) {
        // –û—Å—Ç–∞–≤–ª—è–µ–º system-—Å–æ–æ–±—â–µ–Ω–∏–µ (–µ—Å–ª–∏ –æ–Ω–æ –µ—Å—Ç—å) –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ MAX_CONTEXT_MESSAGES-1 —Å–æ–æ–±—â–µ–Ω–∏–π
        conversationHistory = conversationHistory.slice(-MAX_CONTEXT_MESSAGES);
    }
    
    // 3. –°–æ–∑–¥–∞–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
    const messageElement = document.createElement('div');
    messageElement.className = `${sender}-message message`;
    // –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ Markdown –≤ HTML
    messageElement.innerHTML = DOMPurify 
    ? DOMPurify.sanitize(marked.parse(text))  // –ï—Å–ª–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω DOMPurify
    : marked.parse(text);                     // –ë–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
    
    // 4. –î–æ–±–∞–≤–ª—è–µ–º –≤ —á–∞—Ç (–ø–µ—Ä–µ–¥ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–º –ø–µ—á–∞—Ç–∏, –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å)
    messageArea.insertBefore(messageElement, typingIndicator);
    
    // 5. –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑ –∫ –Ω–æ–≤–æ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
    messageArea.scrollTop = messageArea.scrollHeight;
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–ë–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç"
    function showTypingIndicator() {
        typingIndicator.style.display = 'block';
        messageArea.scrollTop = messageArea.scrollHeight;
    }
    
    function hideTypingIndicator() {
        typingIndicator.style.display = 'none';
    }
    
    // –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
    async function sendMessage() {
        const question = userInput.value.trim();
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞: –ø—É—Å—Ç–æ–µ –ª–∏ –ø–æ–ª–µ –≤–≤–æ–¥–∞?
        if (!question) return;
        
        // 1. –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞ –î–û –æ—Ç–ø—Ä–∞–≤–∫–∏
        userInput.value = '';
        
        // 2. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ —á–∞—Ç–µ
        addMessage(question, 'user');
        
        // 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä "–±–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç"
        showTypingIndicator();
        
        try {
            // 4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –Ω–∞—à –±—ç–∫–µ–Ω–¥ Vercel
            const response = await fetch(BACKEND_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            question: question,
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –í–°–Æ –∏—Å—Ç–æ—Ä–∏—é, –∫—Ä–æ–º–µ —Å–∞–º–æ–≥–æ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è (–æ–Ω–æ –±—É–¥–µ—Ç —Ç–µ–∫—É—â–∏–º –≤–æ–ø—Ä–æ—Å–æ–º)
            history: conversationHistory.slice(0, -1)
        })
    });
            
            // 5. –ü—Ä—è—á–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø–µ—á–∞—Ç–∏
            hideTypingIndicator();
            
            // 6. –ü—Ä–æ–≤–µ—Ä—è–µ–º, —É—Å–ø–µ—à–µ–Ω –ª–∏ –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            if (!response.ok) {
                throw new Error(`–û—à–∏–±–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞: ${response.status}`);
            }
            
            // 7. –ü–æ–ª—É—á–∞–µ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
            const data = await response.json();
            
            // 8. –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –±–æ—Ç–∞ –≤ —á–∞—Ç
            if (data.answer) {
                addMessage(data.answer, 'bot');
            } else {
                throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
            }
            
        } catch (error) {
            // 9. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (—Å–µ—Ç—å, —Å–µ—Ä–≤–µ—Ä, –ø–∞—Ä—Å–∏–Ω–≥)
            hideTypingIndicator();
            console.error('–û—à–∏–±–∫–∞:', error);
            
            // 10. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
            addMessage('–ò–∑–≤–∏–Ω–∏—Ç–µ, –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –≤–∞—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É.', 'bot');
        }
    }
    
    // ===== –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–ë–´–¢–ò–ô =====
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –∫–ª–∏–∫—É –Ω–∞ –∫–Ω–æ–ø–∫—É
    sendButton.addEventListener('click', sendMessage);
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ –Ω–∞–∂–∞—Ç–∏—é Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    userInput.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            sendMessage();
        }
    });
    
    // ===== –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –í–û–ó–ú–û–ñ–ù–û–°–¢–ò =====
    
    // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.addEventListener('load', () => {
        userInput.focus();
    });
    
    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–Ω–æ–ø–∫—É "–û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é"
    // function clearChat() {
    //     conversationHistory = [];
    //     messageArea.innerHTML = '<div class="typing-indicator" id="typing-indicator">–ë–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...</div>';
    //     addMessage('–ß–∞—Ç –æ—á–∏—â–µ–Ω. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?', 'bot');
    // }
</script>
</body>
</html>
